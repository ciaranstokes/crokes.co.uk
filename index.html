<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rezlynx Repository</title>
    <!-- Favicon: Lightning Bolt -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext x='50%25' y='85%25' style='font-size:90px;text-anchor:middle;'%3E%E2%9A%A1%3C/text%3E%3C/svg%3E" type="image/svg+xml">
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* --- General Super App Styles --- */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #faf5ff; 
        }
        .card {
            box-shadow: 0 10px 30px -5px rgba(109, 40, 217, 0.1), 0 4px 10px -2px rgba(109, 40, 217, 0.05);
            border-width: 1px;
            border-radius: 1.5rem;
        }
        input[type="date"]::-webkit-calendar-picker-indicator {
            opacity: 0;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            cursor: pointer;
        }
        input[type="date"] {
            appearance: none;
            -moz-appearance: none;
            position: relative;
            padding-right: 3rem;
        }
        .app-content {
            display: none; /* All app views are hidden by default */
        }
        .app-content.active {
            display: block; /* The active app view is shown */
        }
        .nav-button.active {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }

        /* --- HK Plan Generator Styles --- */
        .control-area {
            border-radius: 1.5rem;
            padding: 1.5rem;
            background-color: white;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.05);
            border: 1px solid #e0f2fe;
        }
        
        /* New class for compact display items in the screen view table */
        .compact-display span {
            font-size: 1rem; 
            font-weight: 600; 
        }

        /* --- Front Hall Styles (Imported from ResHub_old) --- */
        .source-badge {
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 9999px;
            font-weight: 700;
            text-transform: uppercase;
            display: inline-block;
            color: white;
        }
        .source-booking { background-color: #003580; }
        .source-expedia { background-color: #FFC20E; color: black; }
        .source-direct { background-color: #059669; }
        .source-other { background-color: #6b7280; }
        /* Added extra sources to match current system */
        .source-internal { background-color: #4ade80; color: black; }
        .source-transfer { background-color: #f97316; }
        .source-guestline { background-color: #64748b; }
        
        .note-line {
            display: block;
            font-size: 0.85rem;
            margin-top: 2px;
            color: #374151;
        }
        .note-label {
            font-weight: 700;
            color: #4b5563;
            font-size: 0.75rem;
            text-transform: uppercase;
            margin-right: 4px;
        }
        .vcc-alert {
            color: #be123c;
            font-weight: 800;
            font-size: 0.75rem;
            text-transform: uppercase;
            background-color: #ffe4e6;
            padding: 2px 6px;
            border-radius: 4px;
            display: inline-block;
            margin-bottom: 2px;
        }

        /* --- Print Specific Styles --- */
        @media print {
            body { 
                -webkit-print-color-adjust: exact !important; 
                print-color-adjust: exact !important; 
                background-color: #ffffff !important;
                font-size: 10pt; /* Adjusted base print font size */
            }
            .no-print { display: none !important; }

            /* General Print Table for Front Hall & Breakfast */
            .print-section-table { width: 100%; border-collapse: collapse; margin-bottom: 1.5rem; }
            .print-section-table th, .print-section-table td {
                border: 1px solid #ddd;
                padding: 8px;
                text-align: left;
                vertical-align: top; /* Ensure notes start at top */
            }
            .print-section-table th {
                background-color: #f3f4f6 !important;
                font-weight: bold;
            }
            .page-break { page-break-before: always; }

            /* HK Plan Print */
            #print-table-container { display: block !important; }
            .print-table-classic { width: 100%; border-collapse: collapse; margin-bottom: 2rem; }
            .floor-section-print { page-break-inside: avoid; margin-bottom: 2rem; }
            .print-table-classic th, .print-table-classic td { 
                border: 1px solid #334155; 
                padding: 0.3rem; /* Slightly reduced padding */
                text-align: center; 
                font-size: 11px; /* Smaller font size for table data */
                color: black !important; 
            }
            .print-table-classic th { 
                font-weight: bold; 
                font-size: 12px; /* Keep headers slightly larger */
            }
            .print-table-classic th:first-child, .print-table-classic td:first-child { 
                background-color: #f1f5f9 !important; 
                text-align: left; 
                font-weight: bold; 
            }
            
            .print-table-classic td {
                line-height: 1.1; 
            }
            .print-table-classic td > span {
                font-size: 0.65rem !important; 
                line-height: 1 !important; 
                display: inline-block;
            }
            .print-table-classic td > span > span {
                font-size: 8px !important; 
            }

            /* Print list styles for Extras/Pets */
            #print-table-container h3 {
                font-size: 1rem !important; 
            }
            #print-table-container ul, #print-table-container p {
                font-size: 0.9rem !important; 
            }
            #print-table-container ul li span {
                 font-size: 1rem !important; 
            }

            /* Kitchen Products Print */
            @page { size: A4 portrait; margin: 0.4in 0.75in; }
            #kitchen-app-container #results, #kitchen-app-container #results * { visibility: visible; }
            #kitchen-app-container #results { position: absolute; left: 0; top: 0; width: 100%; padding: 0; }
            #kitchen-app-container #reportTitle { display: block !important; color: #581c87 !important; text-align: center; font-size: 1.5rem; font-weight: bold; margin-bottom: 1rem; }
            #kitchen-app-container table { width: 100%; border-collapse: separate; border-spacing: 0; }
            #kitchen-app-container thead { background-color: #fae8ff !important; }
            #kitchen-app-container th { padding: 12px 24px; text-align: center; font-size: 0.9rem; font-weight: bold; color: #581c87 !important; text-transform: uppercase; letter-spacing: 0.05em; border: none; }
            #kitchen-app-container th:first-child { border-top-left-radius: 1rem; }
            #kitchen-app-container th:last-child { border-top-right-radius: 1rem; }
            #kitchen-app-container td { padding: 16px 24px; text-align: center; font-size: 1rem; border-bottom: 1px solid #fae8ff; color: #1f2937; }
            #kitchen-app-container tr:last-child td { border-bottom: none; }
            #kitchen-app-container td:nth-child(2), #kitchen-app-container td:nth-child(3) { font-weight: 600; }
            #kitchen-app-container td div span:first-child { font-weight: bold; color: #000 !important; }
            #kitchen-app-container td div { display: flex !important; align-items: center; justify-content: center; gap: 0.5rem; }
        }
    </style>
</head>
<body class="p-4 sm:p-1 min-h-screen">

    <div class="max-w-screen-2xl mx-auto">
        
        <!-- Navigation Links Card -->
        <div class="card bg-white p-4 sm:p-6 rounded-3xl border-violet-100 mt-6 md:mt-12 no-print">
            <div id="main-nav" class="grid grid-cols-2 md:grid-cols-5 gap-4">
                <a href="#" data-target="home-app" class="nav-button bg-gray-500 text-white font-bold h-20 rounded-2xl hover:bg-gray-600 transition duration-150 shadow-md transform hover:scale-[1.03] active:scale-[0.98] flex items-center justify-center p-2 active">
                    <span class="text-center">Home Hub</span>
                </a>
                <a href="#" data-target="breakfast-app" class="nav-button bg-emerald-500 text-white font-bold h-20 rounded-2xl hover:bg-emerald-600 transition duration-150 shadow-md transform hover:scale-[1.03] active:scale-[0.98] flex items-center justify-center p-2">
                    <span class="text-center">Breakfast List</span>
                </a>
                <a href="#" data-target="kitchen-app" class="nav-button bg-pink-500 text-white font-bold h-20 rounded-2xl hover:bg-pink-600 transition duration-150 shadow-md transform hover:scale-[1.03] active:scale-[0.98] flex items-center justify-center p-2">
                    <span class="text-center">Kitchen List</span>
                </a>
                <a href="#" data-target="hk-app" class="nav-button bg-sky-500 text-white font-bold h-20 rounded-2xl hover:bg-sky-600 transition duration-150 shadow-md transform hover:scale-[1.03] active:scale-[0.98] flex items-center justify-center p-2">
                    <span class="text-center">Housekeeping Plan</span>
                </a>
                <a href="#" data-target="fronthall-app" class="nav-button bg-orange-500 text-white font-bold h-20 rounded-2xl hover:bg-orange-600 transition duration-150 shadow-md transform hover:scale-[1.03] active:scale-[0.98] flex items-center justify-center p-2">
                    <span class="text-center">Front Hall</span>
                </a>
            </div>
        </div>

        <!-- App Content Area -->
        <div class="mt-8">

            <!-- HOME / MASTER HUB APP -->
            <div id="home-app" class="app-content active">
                 <div class="w-full mb-12">
                    <div class="card bg-white p-12 sm:p-16 rounded-3xl border-violet-100 flex flex-col justify-center items-center text-center shadow-lg">
                        <h2 class="text-4xl font-extrabold text-gray-800 mb-6 tracking-tight">Welcome</h2>
                        <p class="text-2xl text-gray-600 font-medium">Mews is dead long live the king</p>
                    </div>
                </div>
            </div>

            <!-- BREAKFAST TRACKER APP -->
            <div id="breakfast-app" class="app-content">
                <div class="container mx-auto px-4 py-8 lg:py-12">
                    <header class="text-center mb-8 lg:mb-12 no-print">
                        <div class="inline-flex items-center justify-center gap-3 bg-green-100 text-green-800 px-6 py-3 rounded-3xl hover:bg-green-200 transition duration-150 shadow-md">
                             <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight">Breakfast List</h1>
                        </div>
                    </header>
                    <main class="bg-white/70 backdrop-blur-sm p-6 lg:p-8 rounded-3xl shadow-xl shadow-green-200/50">
                        <div class="grid grid-cols-1 lg:grid-cols-2 lg:gap-8">
                            <div class="flex flex-col gap-6 no-print">
                                <div class="bg-white p-6 rounded-2xl border border-gray-200/80">
                                    <label for="orderData" class="block text-sm font-bold text-green-800 mb-2">Breakfast Data (Paste Here)</label>
                                    <textarea id="orderData" oninput="breakfast_calculateTotal()" rows="4" class="w-full p-4 bg-gray-50 border border-gray-200 rounded-2xl focus:ring-2 focus:ring-green-300 focus:border-green-400" placeholder="Paste Rezlynx data here..."></textarea>
                                </div>
                                <div class="bg-green-100 p-6 rounded-2xl text-center border border-green-200">
                                    <h2 class="text-lg font-semibold text-green-800 mb-2">Total Breakfasts</h2>
                                    <p id="totalAmount" class="text-6xl font-extrabold text-green-600">0</p>
                                </div>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <button onclick="breakfast_print()" class="bg-green-500 text-white font-bold py-4 px-4 rounded-2xl hover:bg-green-600 transition-all">Print Report</button>
                                    <button onclick="breakfast_clearData()" class="bg-gray-400 text-white font-bold py-4 px-4 rounded-2xl hover:bg-gray-500 transition-all">Clear Data</button>
                                </div>
                            </div>
                            <div class="mt-8 lg:mt-0">
                                <div class="bg-white p-6 rounded-2xl border border-gray-200/80 h-full">
                                    <h3 class="text-xl font-semibold text-gray-800 mb-4 text-center">Breakfast List</h3>
                                    <div class="overflow-auto h-[450px] rounded-xl border border-gray-200">
                                        <table class="min-w-full divide-y divide-gray-200">
                                            <thead class="bg-green-50 sticky top-0">
                                                <tr><th class="px-6 py-3 text-left text-xs font-medium text-green-800 uppercase">Room</th><th class="px-6 py-3 text-left text-xs font-medium text-green-800 uppercase">Guest</th><th class="px-6 py-3 text-left text-xs font-medium text-green-800 uppercase">Amount</th></tr>
                                            </thead>
                                            <tbody id="ordersTableBody" class="bg-white divide-y divide-gray-100">
                                                <tr><td colspan="3" class="px-6 py-12 text-center text-gray-500">No data processed yet.</td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </main>
                </div>
            </div>

            <!-- KITCHEN PRODUCTS APP -->
            <div id="kitchen-app" class="app-content">
                <div id="kitchen-app-container" class="container mx-auto p-4 sm:p-6 md:p-8">
                     <header class="flex items-center gap-4 mb-8 no-print">
                         <div class="flex items-center justify-center gap-3 bg-pink-100 text-pink-800 px-6 py-3 rounded-3xl shadow-md">
                            <h1 class="text-3xl md:text-4xl font-bold text-purple-900">Kitchen List</h1>
                        </div>
                        <input type="date" id="kitchen-date-picker" class="py-3 px-4 border border-gray-300 rounded-xl focus:ring-4 focus:ring-pink-200">
                    </header>
                    <main class="bg-white p-6 sm:p-8 rounded-3xl shadow-xl">
                        <div id="input-section" class="grid grid-cols-1 md:grid-cols-2 md:gap-8 items-start no-print">
                            <div class="flex flex-col h-full">
                                <label for="kitchen_rawData" class="block text-base font-bold text-purple-800 mb-2">Data Input</label>
                                <textarea id="kitchen_rawData" rows="10" class="w-full p-4 border border-gray-300 rounded-2xl focus:ring-2 focus:ring-fuchsia-500" placeholder="Paste Kitchen Products data..."></textarea>
                                <div class="mt-6 flex gap-4">
                                    <button id="kitchen_mainPrintBtn" class="bg-fuchsia-600 text-white font-bold py-3 px-6 rounded-2xl hover:bg-fuchsia-700 w-full">Print Report</button>
                                    <button id="kitchen_clearBtn" class="bg-fuchsia-100 text-fuchsia-800 font-bold py-3 px-6 rounded-2xl hover:bg-fuchsia-200 w-full">Clear</button>
                                </div>
                            </div>
                            <div class="bg-fuchsia-50 p-6 rounded-2xl mt-6 md:mt-0">
                                <h3 class="font-bold text-purple-800 mb-4">Instructions</h3>
                                <p class="text-gray-700">Paste the Daily Kitchen Products report from Mews/Rezlynx to generate the visual list.</p>
                            </div>
                        </div>
                        <div id="kitchen_error-message" class="hidden mt-6 p-4 bg-pink-100 text-pink-700 border border-pink-300 rounded-2xl">Parsing Error.</div>
                        <h2 id="reportTitle" class="text-2xl font-bold text-center my-4 hidden">Kitchen List</h2>
                        <div id="results" class="mt-8"></div>
                    </main>
                </div>
            </div>

            <!-- HOUSEKEEPING (HK) APP -->
            <div id="hk-app" class="app-content">
                <div class="container mx-auto my-10 max-w-5xl no-print">
                    <header class="flex items-center gap-4 mb-6">
                         <div class="flex items-center justify-center gap-3 bg-sky-100 text-sky-800 px-6 py-3 rounded-3xl hover:bg-sky-200 transition duration-150 shadow-md">
                            <h1 class="text-4xl font-extrabold text-center text-sky-700">Housekeeping Plan</h1>
                        </div>
                        <div class="relative">
                            <input type="date" id="hk-date-picker" class="w-full py-3 px-4 border border-gray-300 bg-white rounded-xl focus:ring-4 focus:ring-sky-200 transition duration-200 text-base appearance-none">
                        </div>
                    </header>
                    <div class="control-area mb-6">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="md:col-span-1 flex flex-col justify-start">
                                <h2 class="text-xl font-extrabold text-sky-700 mb-4">Report Details</h2>
                                <label for="reportDate" class="block text-base font-semibold text-gray-700 mb-2">Report Date:</label>
                                <input type="date" id="reportDate" class="w-full p-4 border-2 border-cyan-300 bg-cyan-50 rounded-2xl text-cyan-700 font-bold focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition shadow-inner">
                                <div class="mt-4 flex flex-col gap-3">
                                    <button id="clearDataBtn" class="w-full bg-red-500 text-white font-extrabold py-3 px-6 rounded-2xl hover:bg-red-600 transition duration-300">Clear Data</button>
                                    <button id="printBtn" class="w-full bg-cyan-500 text-white font-extrabold py-3 px-8 rounded-2xl hover:bg-cyan-600 transition duration-300">Print Checklist</button>
                                    <div id="status" class="text-center mt-2 text-sky-600 font-medium text-sm"></div>
                                </div>
                            </div>
                            <div class="md:col-span-2">
                                <label for="dataText" class="block text-xl font-extrabold text-sky-700 mb-4">Reservation Data (Paste Here)</label>
                                <textarea id="dataText" rows="12" placeholder="Paste Rezlynx House Status report here..." class="w-full p-4 border border-sky-300 rounded-2xl focus:outline-none focus:ring-2 focus:ring-sky-500 resize-none min-h-[300px]"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="control-area mt-6">
                        <h2 class="text-2xl font-extrabold text-sky-700 mb-6 text-center">Print Options & Customization</h2>
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            <div class="p-5 bg-sky-50 rounded-2xl shadow-lg border border-sky-200">
                                <h3 class="text-xl font-bold text-sky-700 mb-4">Table Rows</h3>
                                <div class="grid grid-cols-2 gap-4 text-sm md:text-base" id="rowCheckboxes">
                                    <div class="flex items-center"><input type="checkbox" id="showUsedLastNightRow" class="form-checkbox h-5 w-5 text-sky-500 rounded-md"><label for="showUsedLastNightRow" class="ml-2">Used Last Night</label></div>
                                    <div class="flex items-center"><input type="checkbox" id="showArrivingTodayRow" class="form-checkbox h-5 w-5 text-sky-500 rounded-md"><label for="showArrivingTodayRow" class="ml-2">Arriving Today</label></div>
                                    <div class="flex items-center"><input type="checkbox" id="showGuestsRow" class="form-checkbox h-5 w-5 text-sky-500 rounded-md"><label for="showGuestsRow" class="ml-2">Guests</label></div>
                                    <div class="flex items-center"><input type="checkbox" id="showPetRow" checked class="form-checkbox h-5 w-5 text-sky-500 rounded-md"><label for="showPetRow" class="ml-2">Pet</label></div>
                                    <div class="flex items-center"><input type="checkbox" id="showTwinRow" checked class="form-checkbox h-5 w-5 text-sky-500 rounded-md"><label for="showTwinRow" class="ml-2">Twin</label></div>
                                    <div class="flex items-center"><input type="checkbox" id="showDaybedRow" checked class="form-checkbox h-5 w-5 text-sky-500 rounded-md"><label for="showDaybedRow" class="ml-2">Daybed</label></div>
                                    <div class="flex items-center"><input type="checkbox" id="showTrundleRow" checked class="form-checkbox h-5 w-5 text-sky-500 rounded-md"><label for="showTrundleRow" class="ml-2">Trundle</label></div>
                                    <div class="flex items-center"><input type="checkbox" id="showExtrasRow" checked class="form-checkbox h-5 w-5 text-sky-500 rounded-md"><label for="showExtrasRow" class="ml-2 font-bold">Extra</label></div>
                                </div>
                            </div>
                            <div class="p-5 bg-sky-50 rounded-2xl shadow-lg border border-sky-200">
                                <h3 class="text-xl font-bold text-sky-700 mb-4">Info & Lists</h3>
                                <div class="grid grid-cols-2 gap-4 text-sm md:text-base" id="listCheckboxes">
                                    <div class="flex items-center"><input type="checkbox" id="showDepartingRoomInfo" class="form-checkbox h-5 w-5 text-sky-500 rounded-md"><label for="showDepartingRoomInfo" class="ml-2">Departing Info</label></div>
                                    <div class="flex items-center"><input type="checkbox" id="showStayingRoomInfo" class="form-checkbox h-5 w-5 text-sky-500 rounded-md"><label for="showStayingRoomInfo" class="ml-2">Staying Info</label></div>
                                    <div class="flex items-center"><input type="checkbox" id="showStayingRoomsList" checked class="form-checkbox h-5 w-5 text-sky-500 rounded-md"><label for="showStayingRoomsList" class="ml-2">Staying List</label></div>
                                    <div class="flex items-center"><input type="checkbox" id="showPetRoomsList" class="form-checkbox h-5 w-5 text-sky-500 rounded-md"><label for="showPetRoomsList" class="ml-2">Pet List</label></div>
                                    <div class="flex items-center"><input type="checkbox" id="showTwinRoomsList" class="form-checkbox h-5 w-5 text-sky-500 rounded-md"><label for="showTwinRoomsList" class="ml-2">Twin List</label></div>
                                    <div class="flex items-center"><input type="checkbox" id="showExtrasRoomsList" checked class="form-checkbox h-5 w-5 text-sky-500 rounded-md"><label for="showExtrasRoomsList" class="ml-2">Extras List</label></div>
                                </div>
                            </div>
                             <div class="p-5 bg-cyan-50 rounded-2xl shadow-lg border border-cyan-200 flex flex-col items-center justify-center">
                                <h3 id="sparkleModeTitle" class="text-xl font-bold text-cyan-700 cursor-pointer hover:text-cyan-900 transition duration-150 inline-block p-1 rounded">Work Mode</h3>
                                <div id="sparkleOptionsContainer" class="hidden flex flex-col gap-4 w-full mt-4">
                                    <div class="flex items-center justify-between p-3 bg-white rounded-xl border border-cyan-200 shadow-sm">
                                        <span class="text-gray-700 font-medium">Change Checkmark:</span>
                                        <button id="changeTickBtn" class="font-bold text-sky-600 text-2xl">‚úîÔ∏è</button>
                                    </div>
                                    <div class="flex items-center justify-between p-3 bg-white rounded-xl border border-cyan-200 shadow-sm">
                                        <label class="block text-gray-700 font-medium">Pet Icon:</label>
                                        <span id="petEmojiDisplay" class="text-2xl">üê∂</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="no-print"><div id="output-container" class="container mx-auto p-4"><div id="placeholder" class="text-center text-gray-500 p-10">Your generated cleaning report will appear here.</div></div></div>
                <div id="print-table-container" style="display: none;"></div>
            </div>

            <!-- FRONT HALL APP (RESTORED & FIXED) -->
            <div id="fronthall-app" class="app-content">
                <div class="container mx-auto px-4 py-8 lg:py-10 no-print">
                    <header class="flex flex-col md:flex-row items-center justify-between gap-6 mb-8">
                        <div class="inline-flex items-center justify-center gap-3 bg-orange-100 text-orange-800 px-8 py-4 rounded-3xl shadow-md">
                             <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight">Front Hall üõéÔ∏è</h1>
                        </div>
                        <div class="flex items-center gap-3">
                            <label class="font-bold text-gray-700">Date:</label>
                            <input type="date" id="fh-date-picker" class="py-3 px-4 border border-gray-300 bg-white rounded-xl focus:ring-4 focus:ring-orange-200 transition duration-200 shadow-sm">
                        </div>
                    </header>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                         <!-- Input Area -->
                        <div class="lg:col-span-1 flex flex-col gap-4">
                            <div class="bg-white p-6 rounded-3xl border border-orange-200 shadow-lg">
                                <label for="fh-data-input" class="block text-lg font-bold text-gray-800 mb-2">Paste Report Data</label>
                                <textarea id="fh-data-input" oninput="fh_processData()" rows="12" class="w-full p-4 bg-orange-50/50 border border-orange-200 rounded-2xl focus:ring-2 focus:ring-orange-400 focus:border-orange-500 transition resize-none" placeholder="Paste Rezlynx House Status data here..."></textarea>
                                <div class="mt-4 flex gap-3">
                                     <button onclick="fh_printCurrentView()" class="flex-1 bg-gray-800 text-white font-bold py-3 rounded-xl hover:bg-gray-900 transition shadow-md flex items-center justify-center gap-2">
                                         <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 6 2 18 2 18 9"></polyline><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><rect x="6" y="14" width="12" height="8"></rect></svg>
                                         Print List
                                     </button>
                                     <button onclick="fh_clearData()" class="px-6 bg-gray-200 text-gray-600 font-bold py-3 rounded-xl hover:bg-gray-300 transition">Clear</button>
                                </div>
                            </div>
                            <!-- Legend -->
                            <div class="bg-white p-5 rounded-2xl border border-gray-100 shadow-sm">
                                <h3 class="font-bold text-gray-700 mb-3 text-sm uppercase tracking-wide">Key</h3>
                                <div class="flex flex-wrap gap-2">
                                    <span class="source-badge source-booking">Booking.com</span>
                                    <span class="source-expedia">Expedia</span>
                                    <span class="source-direct">Direct</span>
                                    <span class="px-2 py-1 bg-red-100 text-red-800 rounded-md text-xs font-bold border border-red-200">üí≥ VCC Alert</span>
                                </div>
                            </div>
                        </div>

                        <!-- Results Area -->
                        <div class="lg:col-span-2">
                             <div class="flex items-center gap-4 mb-4">
                                <button onclick="fh_switchView('arrivals')" id="btn-view-arr" class="flex-1 py-3 font-bold rounded-xl transition bg-orange-500 text-white shadow-md">Arrivals</button>
                                <button onclick="fh_switchView('departures')" id="btn-view-dep" class="flex-1 py-3 font-bold rounded-xl transition bg-white text-gray-600 border border-gray-200 hover:bg-gray-50">Departures</button>
                             </div>

                             <div id="fh-results-container" class="bg-white p-6 rounded-3xl border border-gray-200 shadow-xl min-h-[400px]">
                                 <div id="fh-placeholder" class="h-full flex flex-col items-center justify-center text-gray-400 opacity-60 mt-10">
                                     <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg>
                                     <p class="mt-4 font-medium">Paste data to generate lists</p>
                                 </div>
                                 <div id="fh-list-content" class="hidden">
                                     <!-- Dynamic Content -->
                                 </div>
                             </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // --- SUPER APP NAVIGATION LOGIC ---
        document.addEventListener('DOMContentLoaded', function() {
            const navButtons = document.querySelectorAll('#main-nav .nav-button');
            const appContents = document.querySelectorAll('.app-content');

            navButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.dataset.target;
                    navButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    appContents.forEach(content => {
                        if (content.id === targetId) {
                            content.classList.add('active');
                        } else {
                            content.classList.remove('active');
                        }
                    });
                });
            });

             // Initialize all app scripts
            breakfast_init();
            kitchen_init();
            hk_init();
            fh_init();
        });

        // --- MASTER HUB SCRIPT ---
        function master_init() { }

        // --- BREAKFAST TRACKER SCRIPT (UPDATED) ---
        let breakfast_detectedDate = null; 

        function breakfast_init() { }
        function breakfast_formatDateForButton(date) { const day = date.getDate(); let suffix = 'th'; if (day % 10 === 1 && day !== 11) suffix = 'st'; else if (day % 10 === 2 && day !== 12) suffix = 'nd'; else if (day % 10 === 3 && day !== 13) suffix = 'rd'; const month = date.toLocaleDateString('en-GB', { month: 'short' }); return `${day}${suffix} ${month}`; }

        function breakfast_calculateTotal() {
            let data = document.getElementById('orderData').value;
            const dateMatch = data.match(/(\d{2})\/([A-Za-z]{3})\/(\d{4})/);
            if (dateMatch) {
                const [_, day, monthStr, year] = dateMatch;
                const months = {Jan:0, Feb:1, Mar:2, Apr:3, May:4, Jun:5, Jul:6, Aug:7, Sep:8, Oct:9, Nov:10, Dec:11};
                breakfast_detectedDate = new Date(year, months[monthStr], day);
            }

            const tableBody = document.getElementById('ordersTableBody');
            tableBody.innerHTML = '';
            
            const lines = data.split('\n');
            const orders = {}; 
            let totalBreakfasts = 0;

            // Updated Parser logic for wrapped lines
            let currentRecord = null;
            
            // Regex to find start of row. Captures: Room, Ref, Name, Code
            const startRowRegex = /^(\d{3})\s+(BK\S+)\s+(.+?)\s+(SALE_BFAST|BREAKFAST)\b/i;
            // Regex to find Quantity and Date line
            const qtyDateRegex = /\b(\d+)\s+(\d{2}\/[A-Za-z]{3}\/\d{4})/;

            lines.forEach(line => {
                line = line.trim();
                if(!line) return;

                // Check if this line starts a new record
                const startMatch = line.match(startRowRegex);
                if (startMatch) {
                    currentRecord = {
                        room: startMatch[1],
                        guest: startMatch[3].trim(),
                        foundQty: false
                    };
                }

                // Check if we found the quantity for the current record
                if (currentRecord && !currentRecord.foundQty) {
                    const qtyMatch = line.match(qtyDateRegex);
                    if (qtyMatch) {
                        const qty = parseInt(qtyMatch[1], 10);
                        const key = `${currentRecord.room}|${currentRecord.guest}`;
                        if (!orders[key]) orders[key] = 0;
                        orders[key] += qty;
                        
                        currentRecord.foundQty = true; // Mark as done
                        currentRecord = null; // Reset for next
                    }
                }
            });

            const orderList = Object.keys(orders).map(key => {
                const [room, guest] = key.split('|');
                return { room, guest, amount: orders[key] };
            });

            orderList.sort((a, b) => parseInt(a.room) - parseInt(b.room));

            if (orderList.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="3" class="px-6 py-12 text-center text-gray-500"><span>No breakfast orders found.</span></td></tr>`;
                document.getElementById('totalAmount').textContent = '0';
                return;
            }

            orderList.forEach(order => {
                totalBreakfasts += order.amount;
                const row = document.createElement('tr');
                row.innerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${order.room}</td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${order.guest}</td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${order.amount}</td>`;
                tableBody.appendChild(row);
            });

            document.getElementById('totalAmount').textContent = totalBreakfasts;
        }

        function breakfast_clearData() { document.getElementById('orderData').value = ''; document.getElementById('totalAmount').textContent = '0'; document.getElementById('ordersTableBody').innerHTML = `<tr><td colspan="3" class="px-6 py-12 text-center text-gray-500"><span>No data processed yet.</span></td></tr>`; }
        function breakfast_print() {
            const printDate = breakfast_detectedDate || new Date();
            breakfast_printTable(printDate);
        }
        function breakfast_printTable(date) {
             const tableBody = document.getElementById('ordersTableBody');
             if (!tableBody || tableBody.children[0].textContent.includes('No data')) return;
             const total = document.getElementById('totalAmount').textContent;
             const dateStr = date.toLocaleDateString('en-GB', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
             
             const rows = Array.from(tableBody.querySelectorAll('tr')).map(r => {
                 const cells = r.querySelectorAll('td');
                 return cells.length >= 3 ? { r: cells[0].textContent, g: cells[1].textContent, a: cells[2].textContent } : null;
             }).filter(Boolean);

             const floors = [
                 {t:'Ground Floor', d: rows.filter(o=>parseInt(o.r)<=6)},
                 {t:'First Floor', d: rows.filter(o=>parseInt(o.r)>=101 && parseInt(o.r)<=130)},
                 {t:'Second Floor', d: rows.filter(o=>parseInt(o.r)>=201 && parseInt(o.r)<=230)}
             ];

             const printW = window.open('', '_blank');
             printW.document.write(`<html><head><title>Breakfast List</title><style>
                 body{font-family:sans-serif;padding:20px;}
                 h1{text-align:center;color:#166534;margin-bottom:5px;}
                 .meta{text-align:center;margin-bottom:20px;color:#166534;font-weight:bold;}
                 .col-container{display:flex;gap:20px;}
                 .col{flex:1;}
                 h3{border-bottom:2px solid #ddd;padding-bottom:5px;margin-top:0;}
                 table{width:100%;border-collapse:collapse;margin-bottom:15px;}
                 th,td{border:1px solid #ccc;padding:5px;text-align:left;}
                 th{background:#f0fdf4;}
                 td:first-child{font-weight:bold;width:15%;text-align:center;}
                 td:last-child{text-align:center;}
             </style></head><body>
                 <h1>Breakfast List</h1>
                 <div class="meta">${dateStr} | Total: ${total}</div>
                 <div class="col-container">
                     <div class="col">
                         ${floors[0].d.length ? `<h3>${floors[0].t}</h3><table><tr><th>Room</th><th>Guest</th><th>Qty</th></tr>${floors[0].d.map(x=>`<tr><td>${x.r}</td><td>${x.g}</td><td>${x.a}</td></tr>`).join('')}</table>` : ''}
                         ${floors[1].d.length ? `<h3>${floors[1].t}</h3><table><tr><th>Room</th><th>Guest</th><th>Qty</th></tr>${floors[1].d.map(x=>`<tr><td>${x.r}</td><td>${x.g}</td><td>${x.a}</td></tr>`).join('')}</table>` : ''}
                     </div>
                     <div class="col">
                         ${floors[2].d.length ? `<h3>${floors[2].t}</h3><table><tr><th>Room</th><th>Guest</th><th>Qty</th></tr>${floors[2].d.map(x=>`<tr><td>${x.r}</td><td>${x.g}</td><td>${x.a}</td></tr>`).join('')}</table>` : ''}
                     </div>
                 </div>
             </body></html>`);
             printW.document.close();
             setTimeout(()=>printW.print(), 200);
        }

        // --- KITCHEN PRODUCTS SCRIPT ---
        function kitchen_init() {
            const rawDataInput = document.getElementById('kitchen_rawData');
            document.getElementById('kitchen_mainPrintBtn').addEventListener('click', () => { if (!document.querySelector('#kitchen-app #results').innerHTML.trim()) { alert("Please paste data to generate a report before printing."); } else { window.print(); } });
            document.getElementById('kitchen_clearBtn').addEventListener('click', () => { rawDataInput.value = ''; document.querySelector('#kitchen-app #results').innerHTML = ''; });
            rawDataInput.addEventListener('input', () => {
                const text = rawDataInput.value;
                const dates = (text.match(/\d{2}\/\d{2}\/\d{4}/g) || []).filter((v,i,a)=>a.indexOf(v)===i).sort((a,b)=> new Date(a.split('/').reverse().join('-')) - new Date(b.split('/').reverse().join('-')));
                if(!dates.length) return;
                let bk = [];
                text.split('\n').forEach(l => {
                    if(l.toLowerCase().includes('all products') || l.toLowerCase().includes('breakfast')) {
                        const nums = l.match(/\b\d+\b/g);
                        if(nums && nums.length >= dates.length) bk = nums.slice(-dates.length);
                    }
                });
                const res = document.querySelector('#kitchen-app #results');
                res.innerHTML = `<table class="w-full"><thead><tr><th>Date</th><th>Breakfasts</th></tr></thead><tbody>${dates.map((d,i)=>`<tr><td>${d}</td><td>${bk[i]||0} üç≥</td></tr>`).join('')}</tbody></table>`;
            });
        }

        // --- HOUSEKEEPING SCRIPT (UPDATED FOR ROBUST PET DETECTION & LOGIC FIX) ---
        function hk_init() {
            const dataTextInput = document.getElementById('dataText');
            const printBtn = document.getElementById('printBtn');
            const clearDataBtn = document.getElementById('clearDataBtn');
            const outputContainer = document.getElementById('output-container');
            const printTableContainer = document.getElementById('print-table-container');
            const statusDiv = document.getElementById('status');
            const placeholder = document.getElementById('placeholder');
            const reportDateInput = document.getElementById('reportDate');

            const showUsedLastNightRowCheckbox = document.getElementById('showUsedLastNightRow');
            const showArrivingTodayRowCheckbox = document.getElementById('showArrivingTodayRow');
            const showGuestsRowCheckbox = document.getElementById('showGuestsRow');
            const showPetRowCheckbox = document.getElementById('showPetRow');
            const showTwinRowCheckbox = document.getElementById('showTwinRow');
            const showDaybedRowCheckbox = document.getElementById('showDaybedRow');
            const showTrundleRowCheckbox = document.getElementById('showTrundleRow');
            const showExtrasRowCheckbox = document.getElementById('showExtrasRow'); 
            const showStayingRoomsListCheckbox = document.getElementById('showStayingRoomsList');
            const showPetRoomsListCheckbox = document.getElementById('showPetRoomsList');
            const showTwinRoomsListCheckbox = document.getElementById('showTwinRoomsList');
            const showExtrasRoomsListCheckbox = document.getElementById('showExtrasRoomsList');
            const showDepartingRoomInfoCheckbox = document.getElementById('showDepartingRoomInfo');
            const showStayingRoomInfoCheckbox = document.getElementById('showStayingRoomInfo');

            const changeTickBtn = document.getElementById('changeTickBtn');
            const currentTickEmojiSpan = document.getElementById('currentTickEmoji');
            const petEmojiDisplay = document.getElementById('petEmojiDisplay');
            const sparkleModeTitle = document.getElementById('sparkleModeTitle');
            const sparkleOptionsContainer = document.getElementById('sparkleOptionsContainer');

            let processedRooms = [];
            const tickEmojis = ['‚úîÔ∏è', '‚úÖ', 'üü¢', '‚≠ê', '‚ú®', 'üíú', 'üíô'];
            let currentTickIndex = 0;
            let isSparkleMode = false;

            const HK_EXTRA_PRODUCTS = [
                { name: 'Late Check Out', key: 'LateCheckOut', emoji: '‚úàÔ∏è', condition: 'DepartureDay', hasValue: false },
                { name: 'Early Check In', key: 'EarlyCheckIn', emoji: 'üõ¨', condition: 'ArrivalDay', hasValue: false },
                { name: 'Cot', key: 'Cot', emoji: 'üõèÔ∏è', condition: 'Arrival', hasValue: false },
                { name: 'Bareca Voucher', key: 'BarecaVoucher', emoji: 'üíµ', condition: 'Arrival', hasValue: true },
                { name: 'Boot Crew Voucher', key: 'BootCrewVoucher', emoji: 'ü•æüíµ', condition: 'Arrival', hasValue: true },
                { name: 'Complimentary Cocktail', key: 'CocktailVoucher', emoji: 'üçπüíµ', condition: 'Arrival', hasValue: true },
                { name: 'Picnic', key: 'Picnic', emoji: 'üß∫', condition: 'Arrival', hasValue: false },
                { name: 'Prosecco', key: 'Prosecco', emoji: 'üçæ', condition: 'Arrival', hasValue: false },
                { name: 'Selection of 6 IPA\'s', key: 'Selectionof6IPAs', emoji: 'üç∫', condition: 'Arrival', hasValue: false },
                { name: 'Birthday', key: 'Birthday', emoji: 'üéâ', condition: 'Arrival', hasValue: false },
                { name: 'Anniversary', key: 'Anniversary', emoji: 'üíù', condition: 'Arrival', hasValue: false }
            ];

           function getExtraValue(keyword, cleanedText) {
                const keywordBase = keyword.replace(/ \(\¬£.*?\)/, '').toLowerCase();
                const perHeadRegex = new RegExp(`${keywordBase.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&')}\\s*\\(\\s*¬£(\\d+)\\s*Per Head\\)`, 'i');
                const perHeadMatch = cleanedText.match(perHeadRegex);
                if (perHeadMatch && perHeadMatch[1]) return parseInt(perHeadMatch[1], 10);
                if (keywordBase.includes('voucher')) {
                    const genericVoucherRegex = /(?:\d+\s*x\s*)?¬£(\d+)\\s*Voucher/i;
                    const genericMatch = cleanedText.match(genericVoucherRegex);
                    if (genericMatch && genericMatch[1]) return parseInt(genericMatch[1], 10);
                }
                const directValueRegex = new RegExp(`(?:\\d+\\s*x\\s*)?¬£(\\d+)\\s*${keywordBase.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&')}`, 'i');
                const directMatch = cleanedText.match(directValueRegex);
                if (directMatch && directMatch[1]) return parseInt(directMatch[1], 10);
                return 0;
            }

            function getFormattedDate(date) {
                const day = String(date.getDate()).padStart(2, '0');
                const month = String(date.getMonth() + 1).padStart(2, '0');
                return `${day}/${month}`;
            }

            function extractBedPreference(cleanedBlock) {
                const bedPrefMatch = cleanedBlock.match(/BED PREFERENCE:(.*?)(\n|$)/i);
                if (bedPrefMatch && bedPrefMatch[1]) {
                    let rawPreference = bedPrefMatch[1].trim();
                    const lastColonIndex = rawPreference.lastIndexOf(':');
                    if (lastColonIndex !== -1) return rawPreference.substring(lastColonIndex + 1).trim();
                    return rawPreference;
                }
                return null;
            }

            // Updated Robust Item Counter
            function getItemCount(keyword, cleanedBlock, duration = 0) {
                let total = 0;
                const keywordBase = keyword.replace(/ \(\¬£.*?\)/, '').toLowerCase();

                if (keywordBase === 'birthday' || keywordBase === 'anniversary' || keywordBase === 'honeymoon') {
                    let regex;
                    if (keywordBase === 'birthday') regex = /\b(b-day|bday|birth\s?day)\b/i;
                    else if (keywordBase === 'anniversary') regex = /\b(an?n?iversary)\b/i;
                    else regex = /\b(ho?n?ey\s?moon)\b/i;
                    if (regex.test(cleanedBlock)) return 1;
                }

                // Enhanced Pet Detection Logic
                if (keywordBase.includes('pet')) {
                     let petCount = 0;
                     // 1. Explicit Quantity: "1 x Pet", "1x Pet", "2 x Pet"
                     const xMatch = cleanedBlock.match(/(\d+)\s*x\s*pet/i);
                     if (xMatch) petCount = Math.max(petCount, parseInt(xMatch[1], 10));

                     // 2. Rezlynx Extras Format: "Pet,,15", "Pet 2,,15" (count lines)
                     const extraMatches = cleanedBlock.match(/Pet(?: \d+)?,,/gi);
                     if (extraMatches) petCount = Math.max(petCount, extraMatches.length);

                     // 3. "Second Pet Guest" text check
                     if (/second\s*pet/i.test(cleanedBlock) || /2nd\s*pet/i.test(cleanedBlock)) petCount = Math.max(petCount, 2);

                     // 4. Keyword "Dog"
                     if (petCount === 0 && /\bdog\b/i.test(cleanedBlock)) petCount = 1;

                     // Duration logic for pet charging (if needed, currently simplified to max count found)
                     return petCount;
                }

                // Standard logic for other items
                const productRegex = new RegExp(`(\\d+)\\s*x\\s+${keywordBase.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&')}`, 'ig');
                let match;
                let productCount = 0;
                while ((match = productRegex.exec(cleanedBlock.toLowerCase())) !== null) {
                    productCount += parseInt(match[1], 10);
                }
                total = productCount;

                if (total === 0) {
                    const implicitRegex = new RegExp(`(?!\\d\\s*x\\s*)\\b${keywordBase.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&')}\\b`, 'ig');
                    if (keywordBase.includes('twin')) {
                        let textToSearch = cleanedBlock.replace(/MEDIUM DOUBLE\/TWIN ROOM/gi, "MEDIUM DOUBLE ROOM");
                        textToSearch = textToSearch.replace(/MEDIUM DOUBLE\/TWIN ACCESS/gi, "MEDIUM DOUBLE ACCESS");
                        textToSearch = textToSearch.replace(/Standard Double or Twin Room/gi, "Standard Double Room");
                        if (implicitRegex.test(textToSearch.toLowerCase())) total = 1;
                    }
                    else if (implicitRegex.test(cleanedBlock.toLowerCase())) {
                        if (keywordBase.includes('zedbed') || keywordBase.includes('daybed') || keywordBase.includes('trundle')) total = 1;
                    }
                }
                if (keywordBase.includes('twin') && total === 0) {
                     if (cleanedBlock.toUpperCase().includes('TWIN BEDS') || cleanedBlock.toUpperCase().includes('MAKE THE BEDS AS: TWIN')) total = 1;
                }
                if (keywordBase.includes('zedbed') && (cleanedBlock.toUpperCase().includes('ZEDBED') || cleanedBlock.toLowerCase().includes('daybed'))) {
                    if (total === 0) total = 1;
                }
                return total;
            }

            function extractExtraProducts(cleanedBlock, duration) {
                const extras = {};
                HK_EXTRA_PRODUCTS.forEach(item => {
                    const count = getItemCount(item.name, cleanedBlock, duration);
                    extras[item.key] = count;
                    if (item.hasValue) {
                        if (count > 0) {
                            const pricePerUnit = getExtraValue(item.name, cleanedBlock);
                            extras[`${item.key}Value`] = count * pricePerUnit;
                        } else {
                            extras[`${item.key}Value`] = 0;
                        }
                    }
                });
                return extras;
            }

            function parseBlock(block, reportDate) {
                const lines = block.split('\n');
                const mainLine = lines[0];

                const dateRegex = /(\d{2}\/[A-Za-z]{3}\/\d{4})\s+(\d{2}\/[A-Za-z]{3}\/\d{4})/;
                const dateMatch = mainLine.match(dateRegex);

                if (!dateMatch) return null;

                const [_, startStr, endStr] = dateMatch;
                const roomMatch = mainLine.substring(dateMatch.index).match(/\b(\d{3})\b/);
                if (!roomMatch) return null;
                const room = roomMatch[1];

                let customerName = mainLine.substring(0, dateMatch.index).trim().replace(/\t/g, ' ');
                const postRoom = mainLine.substring(mainLine.indexOf(room) + 3);
                const guestMatch = postRoom.match(/\s+(\d+)\s+/);
                let guestCount = guestMatch ? parseInt(guestMatch[1], 10) : 2;

                const months = {Jan:0, Feb:1, Mar:2, Apr:3, May:4, Jun:5, Jul:6, Aug:7, Sep:8, Oct:9, Nov:10, Dec:11};
                const [sd, sm, sy] = startStr.split('/');
                const [ed, em, ey] = endStr.split('/');
                
                const startDate = new Date(parseInt(sy), months[sm], parseInt(sd));
                const endDate = new Date(parseInt(ey), months[em], parseInt(ed));

                const reportDateMidnight = new Date(reportDate.getFullYear(), reportDate.getMonth(), reportDate.getDate()).getTime();
                const startDayMidnight = new Date(startDate.getFullYear(), startDate.getMonth(), startDate.getDate()).getTime();
                const endDayMidnight = new Date(endDate.getFullYear(), endDate.getMonth(), endDate.getDate()).getTime();

                let status = 'Stay';
                if (startDayMidnight === reportDateMidnight) status = 'Arrival';
                else if (endDayMidnight === reportDateMidnight) status = 'Depart';
                else if (reportDateMidnight > startDayMidnight && reportDateMidnight < endDayMidnight) status = 'Stay';
                else return null;

                const diffTime = Math.abs(endDate.getTime() - startDate.getTime());
                const duration = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                const roomData = {
                    room: room,
                    status: status,
                    pet: 0, twin: 0, double: 0, daybed: 0, trundle: 0,
                    customerName: customerName,
                    guests: guestCount,
                    BarecaVoucherValue: 0,
                    startDateFormatted: getFormattedDate(startDate),
                    endDateFormatted: getFormattedDate(endDate),
                    reportDateFormatted: getFormattedDate(reportDate),
                    bedPreference: extractBedPreference(block),
                    isVacantRecord: false
                };

                const cleanedBlock = block;
                // Use generic 'Pet' keyword to trigger the robust logic in getItemCount
                roomData.pet = getItemCount('Pet', cleanedBlock, duration);
                roomData.twin = getItemCount('Twin Beds', cleanedBlock, duration) + getItemCount('Twin', cleanedBlock, duration);

                if (roomData.bedPreference) {
                    const preference = roomData.bedPreference.toLowerCase();
                    if (preference.includes('double') || preference.includes('extra-large double') || preference.includes('queen') || preference.includes('king')) {
                        roomData.twin = 0; roomData.double = 1;
                    } else if (preference.includes('twin') || preference.includes('single')) {
                        roomData.twin = 1; roomData.double = 0;
                    }
                }
                roomData.daybed = getItemCount('ZedBed', cleanedBlock, duration) + getItemCount('Daybed', cleanedBlock, duration);
                roomData.trundle = getItemCount('Trundle', cleanedBlock, duration);
                if (roomData.twin === 0) roomData.double = 1;
                Object.assign(roomData, extractExtraProducts(cleanedBlock, duration));
                return roomData;
            }

            function parseVacantLine(line) {
                const match = line.match(/^\s*(\d{3})\s+.*\s+(Departure \/ Dirty Room|Room is Clean)/);
                if (!match) return null;
                const room = match[1];
                const hkStatus = match[2];
                return {
                    room: room,
                    isVacantRecord: true,
                    hkStatus: hkStatus,
                    status: 'Unknown',
                    pet: 0, twin: 0, double: 0, daybed: 0, trundle: 0,
                    customerName: 'Vacant',
                    guests: 0,
                    BarecaVoucherValue: 0
                };
            }

            function processTurnarounds(rooms) {
                const roomsByNumber = {};
                rooms.forEach(room => {
                    if (!roomsByNumber[room.room]) roomsByNumber[room.room] = [];
                    roomsByNumber[room.room].push(room);
                });

                const finalRooms = [];
                for (const roomNumber in roomsByNumber) {
                    let entries = roomsByNumber[roomNumber];
                    let reservations = entries.filter(e => !e.isVacantRecord);
                    const vacantRecords = entries.filter(e => e.isVacantRecord);

                    if (reservations.length > 1) {
                        const uniqueEntries = [];
                        const seenSignatures = new Set();
                        reservations.forEach(e => {
                            const sig = `${e.status}-${e.customerName}`;
                            if (!seenSignatures.has(sig)) {
                                seenSignatures.add(sig);
                                uniqueEntries.push(e);
                            } else {
                                const existing = uniqueEntries.find(u => `${u.status}-${u.customerName}` === sig);
                                if (existing) {
                                    existing.pet = Math.max(existing.pet, e.pet);
                                    existing.twin = Math.max(existing.twin, e.twin);
                                    existing.daybed = Math.max(existing.daybed, e.daybed);
                                    existing.trundle = Math.max(existing.trundle, e.trundle);
                                    HK_EXTRA_PRODUCTS.forEach(prod => {
                                        existing[prod.key] = Math.max(existing[prod.key], e[prod.key]);
                                    });
                                }
                            }
                        });
                        reservations = uniqueEntries;
                    }

                    if (reservations.length > 0) {
                        const vacantStatus = vacantRecords.length > 0 ? vacantRecords[0].hkStatus : null;
                        reservations.forEach(res => {
                            if (res.status === 'Arrival') {
                                if (vacantStatus === 'Departure / Dirty Room') {
                                    res.status = 'Depart/Arrive';
                                    // FIX: Do not assume Twin Turnaround just because room is dirty.
                                    // res.isTwinTurnaround = (res.twin > 0); <- REMOVED THIS
                                }
                            }
                        });

                        if (reservations.length > 1) {
                            const departure = reservations.find(r => r.status === 'Depart');
                            const arrival = reservations.find(r => r.status === 'Arrival' || r.status === 'Depart/Arrive');
                            if (departure && arrival) {
                                if (departure.customerName.toLowerCase() === arrival.customerName.toLowerCase()) {
                                    finalRooms.push({ ...arrival, status: 'Stay' });
                                } else {
                                    finalRooms.push({ ...arrival, status: 'Depart/Arrive', isTwinTurnaround: departure.twin > 0 && arrival.twin > 0 });
                                }
                            } else {
                                const bestEntry = reservations.reduce((prev, current) => {
                                    return (prev.pet + prev.twin) > (current.pet + current.twin) ? prev : current;
                                });
                                finalRooms.push(bestEntry);
                            }
                        } else {
                            finalRooms.push(reservations[0]);
                        }
                    } else {
                        if (vacantRecords.length > 0) {
                            const vac = vacantRecords[0];
                            if (vac.hkStatus === 'Departure / Dirty Room') {
                                finalRooms.push({
                                    room: vac.room,
                                    status: 'Depart',
                                    customerName: 'Vacant',
                                    pet: 0, twin: 0, daybed: 0, trundle: 0, guests: 0, double: 1,
                                    BarecaVoucherValue: 0
                                });
                            }
                        }
                    }
                }
                return finalRooms.sort((a,b) => parseInt(a.room) - parseInt(b.room));
            }

            dataTextInput.addEventListener('input', () => { autoDetectReportDate(); if (dataTextInput.value.trim().length > 5) { parseAndGenerate(); } else { clearOutput(); } });
            clearDataBtn.addEventListener('click', clearData);

            printBtn.addEventListener('click', () => {
                const landscapeStyle = document.createElement('style');
                landscapeStyle.id = 'hk-landscape-style';
                landscapeStyle.innerHTML = '@page { size: A4 landscape; margin: 0.5in; }';
                document.head.appendChild(landscapeStyle);
                window.print();
                window.onafterprint = function() {
                    const styleElement = document.getElementById('hk-landscape-style');
                    if (styleElement) styleElement.remove();
                    window.onafterprint = null;
                };
                setTimeout(() => {
                    const styleElement = document.getElementById('hk-landscape-style');
                    if (styleElement) styleElement.remove();
                }, 1000);
            });

            sparkleModeTitle.addEventListener('click', () => { isSparkleMode = !isSparkleMode; updateSparkleMode(isSparkleMode); });
            changeTickBtn.addEventListener('click', () => { if (isSparkleMode) { currentTickIndex = (currentTickIndex + 1) % tickEmojis.length; currentTickEmojiSpan.textContent = tickEmojis[currentTickIndex]; if (processedRooms.length > 0) renderOutput(processedRooms); } });

            function setupAutoGenerateListeners() {
                const allCheckboxes = [...(document.getElementById('rowCheckboxes')?.querySelectorAll('input[type="checkbox"]') || []), ...(document.getElementById('listCheckboxes')?.querySelectorAll('input[type="checkbox"]') || [])];
                allCheckboxes.forEach(checkbox => checkbox.addEventListener('change', () => { if (processedRooms.length > 0) { renderOutput(processedRooms); updateStatus('Print options updated.', 'success'); } else { updateStatus('Please paste data first.', 'default'); } }));
            }
            setupAutoGenerateListeners();

            function clearData() { dataTextInput.value = ''; reportDateInput.value = ''; processedRooms = []; clearOutput(); updateStatus('Data cleared.', 'default'); }
            function clearOutput() { outputContainer.innerHTML = ''; outputContainer.appendChild(placeholder); printTableContainer.innerHTML = ''; }

            function autoDetectReportDate() {
                const rawText = dataTextInput.value;
                const dateMatch = rawText.match(/(\d{2})\/([A-Za-z]{3})\/(\d{4})/);
                if (dateMatch) {
                    const [_, day, monthStr, year] = dateMatch;
                    const months = {Jan:'01', Feb:'02', Mar:'03', Apr:'04', May:'05', Jun:'06', Jul:'07', Aug:'08', Sep:'09', Oct:'10', Nov:'11', Dec:'12'};
                    const month = months[monthStr];
                    if (month) {
                        reportDateInput.value = `${year}-${month}-${day}`;
                        updateStatus(`Date auto-detected: ${day}/${monthStr}/${year}.`, 'success');
                    }
                }
                else if (!reportDateInput.value) { updateStatus('Date not found.', 'error'); }
            }

            function updateSparkleMode(isSparkle) {
                sparkleModeTitle.textContent = isSparkle ? '‚ú®Sparkle Mode‚ú®' : 'Work Mode';
                sparkleOptionsContainer.classList.toggle('hidden', !isSparkle);
                if (!isSparkle) { currentTickIndex = 0; currentTickEmojiSpan.textContent = tickEmojis[0]; }
                if (processedRooms.length > 0) { renderOutput(processedRooms); updateStatus(`Mode changed.`, 'success'); }
            }

            function parseAndGenerate() {
                const rawText = dataTextInput.value; const reportDateStr = reportDateInput.value;
                if (!reportDateStr || !rawText.trim()) { updateStatus('Please select a date and paste data.', 'error'); return; }
                updateStatus('Parsing...', 'loading');
                const reportDate = new Date(reportDateStr + 'T00:00:00');

                const lines = rawText.split('\n');
                const blocks = [];
                const vacantLines = [];
                let currentBlock = '';

                const resLineRegex = /\d{2}\/[A-Za-z]{3}\/\d{4}.*\d{2}\/[A-Za-z]{3}\/\d{4}/;
                const vacantLineRegex = /^\s*\d{3}\s+.*\s+(Departure \/ Dirty Room|Room is Clean)/;

                lines.forEach(line => {
                    if (resLineRegex.test(line)) {
                        if (currentBlock) blocks.push(currentBlock);
                        currentBlock = line;
                    }
                    else if (vacantLineRegex.test(line)) {
                        vacantLines.push(line);
                        if (currentBlock) { blocks.push(currentBlock); currentBlock = ''; }
                    }
                    else {
                        if (currentBlock) currentBlock += '\n' + line;
                    }
                });
                if (currentBlock) blocks.push(currentBlock);

                if (blocks.length === 0 && vacantLines.length === 0) { updateStatus('No valid room data found. Check data is correct.', 'error'); return; }

                const reservationRooms = blocks.map(block => parseBlock(block, reportDate)).filter(Boolean);
                const vacantRooms = vacantLines.map(line => parseVacantLine(line)).filter(Boolean);
                const allRawData = [...reservationRooms, ...vacantRooms];
                processedRooms = processTurnarounds(allRawData);

                if (processedRooms.length > 0) {
                    renderOutput(processedRooms);
                    updateStatus(`Generated plan for ${processedRooms.length} rooms.`, 'success');
                } else {
                    clearOutput();
                    updateStatus('No reservations found for date.', 'error');
                }
            }
            function renderOutput(rooms) { generateReportView(rooms); generatePrintView(rooms); }

            function getActiveExtras(rooms) {
                const activeExtras = {};
                HK_EXTRA_PRODUCTS.forEach(item => {
                    const key = item.key;
                    if (rooms.some(room => {
                        const status = room.status;
                        let isRelevant = false;
                        if (item.condition === 'DepartureDay') isRelevant = room.reportDateFormatted === room.endDateFormatted;
                        else if (item.condition === 'ArrivalDay') isRelevant = room.reportDateFormatted === room.startDateFormatted;
                        else if (item.condition === 'Arrival') isRelevant = status === 'Arrival' || status === 'Depart/Arrive';
                        return (room[key] > 0 && isRelevant);
                    })) {
                        activeExtras[key] = item;
                    }
                });
                return activeExtras;
            }

            function generateReportView(rooms) {
                outputContainer.innerHTML = '';
                const needsAlertKey = rooms.some(room => room.guests >= 3 && room.daybed === 0 && room.trundle === 0);
                const hasTwinTurnaround = rooms.some(room => room.isTwinTurnaround);
                const activeExtras = getActiveExtras(rooms);
                const keyContainer = document.createElement('div');
                keyContainer.className = 'bg-sky-50 p-4 sm:p-6 rounded-2xl border-2 border-sky-200 mb-8 shadow-md';

                let keyHtml = `<div class="grid grid-cols-2 sm:grid-cols-4 gap-4 text-sm font-semibold text-slate-700">
                    <div class="flex items-center"><span class="inline-block w-5 h-5 mr-2 rounded bg-purple-200"></span>Depart/Arrive</div>
                    <div class="flex items-center"><span class="inline-block w-5 h-5 mr-2 rounded bg-green-200"></span>Arrival</div>
                    <div class="flex items-center"><span class="inline-block w-5 h-5 mr-2 rounded bg-red-200"></span>Depart</div>
                    <div class="flex items-center"><span class="inline-block w-5 h-5 mr-2 rounded bg-blue-200"></span>Stay</div>
                </div>`;

                let detailsHtml = '';
                let extrasHtml = '';

                if (needsAlertKey) detailsHtml += `<div class="flex items-center text-slate-700 font-semibold text-sm"><span class="text-xl mr-2">‚ö†Ô∏è</span>Missing Daybed/Trundle</div>`;
                if (hasTwinTurnaround) detailsHtml += `<div class="flex items-center text-slate-700 font-semibold text-sm"><span class="text-xl mr-2">‚≠ê</span>Twin Turnaround</div>`;

                const renderedExtras = Object.values(activeExtras);
                const isExtrasRowVisible = showExtrasRowCheckbox.checked; 

                if (isExtrasRowVisible && renderedExtras.length > 0) {
                    extrasHtml = `<h4 class="col-span-2 text-base font-bold text-sky-700 mt-2">Product Key (Extras)</h4>`;
                    renderedExtras.forEach(item => {
                        let name = item.name;
                        if (item.hasValue) name += ' (Total Value)';
                        extrasHtml += `<div class="flex items-center text-slate-700 font-semibold text-sm"><span class="text-xl mr-2">${item.emoji}</span>${name}</div>`;
                    });
                }

                if (detailsHtml || extrasHtml) {
                    keyHtml += `<div class="grid grid-cols-2 gap-4 pt-3 mt-3 border-t">`;
                    if (detailsHtml) {
                        keyHtml += `<div class="col-span-2 sm:col-span-1 space-y-2"><h4 class="text-base font-bold text-sky-700">Alerts</h4>${detailsHtml}</div>`;
                        keyHtml += `<div class="col-span-2 sm:col-span-1 space-y-2">${extrasHtml}</div>`;
                    } else if (extrasHtml) {
                        keyHtml += `<div class="col-span-2 space-y-2 grid grid-cols-2 gap-4">${extrasHtml}</div>`;
                    }
                    keyHtml += `</div>`;
                }

                keyContainer.innerHTML = keyHtml;
                outputContainer.appendChild(keyContainer);

                const floors = [{ title: 'Ground Floor', rooms: rooms.filter(r => parseInt(r.room) <= 6) }, { title: 'First Floor', rooms: rooms.filter(r => parseInt(r.room) >= 101 && parseInt(r.room) <= 130) }, { title: 'Second Floor', rooms: rooms.filter(r => parseInt(r.room) >= 201 && parseInt(r.room) <= 230) }];
                floors.forEach(floor => { if (floor.rooms.length > 0) { const floorContainer = document.createElement('div'); floorContainer.className = 'mb-10'; floorContainer.innerHTML = `<h2 class="text-2xl font-bold text-sky-800 mb-3">${floor.title}</h2>`; floorContainer.appendChild(createScreenTableForRooms(floor.rooms)); outputContainer.appendChild(floorContainer); } });

                const listContainer = document.createElement('div'); listContainer.className = 'mt-10 pt-6 border-t-2';

                if (showStayingRoomsListCheckbox.checked) {
                    const staying = rooms.filter(r => r.status === 'Stay').map(r => r.room);
                    if (staying.length > 0) listContainer.appendChild(createScreenListSection('Staying Rooms List', staying.join(', ')));
                }

                if (showPetRoomsListCheckbox.checked) { const pets = rooms.filter(r => r.pet > 0).map(r => r.room); if (pets.length > 0) listContainer.appendChild(createScreenListSection('Pet Rooms List', pets.join(', '))); }
                if (showTwinRoomsListCheckbox.checked) { const twins = rooms.filter(r => r.twin > 0).map(r => r.room); if (twins.length > 0) listContainer.appendChild(createScreenListSection('Twin Rooms List', twins.join(', '))); }

                if (showExtrasRoomsListCheckbox.checked) {
                    const extraRooms = rooms.filter(room => {
                        return HK_EXTRA_PRODUCTS.some(item => {
                            const key = item.key;
                            let isRelevant = false;
                            if (item.condition === 'DepartureDay') isRelevant = room.reportDateFormatted === room.endDateFormatted;
                            else if (item.condition === 'ArrivalDay') isRelevant = room.reportDateFormatted === room.startDateFormatted;
                            else if (item.condition === 'Arrival') isRelevant = room.status === 'Arrival' || room.status === 'Depart/Arrive';
                            return (room[key] > 0 && isRelevant);
                        });
                    });

                    if (extraRooms.length > 0) {
                        const listItems = extraRooms.map(room => {
                            const activeItems = HK_EXTRA_PRODUCTS.filter(item => {
                                const key = item.key;
                                let isRelevant = false;
                                if (item.condition === 'DepartureDay') isRelevant = room.reportDateFormatted === room.endDateFormatted;
                                else if (item.condition === 'ArrivalDay') isRelevant = room.reportDateFormatted === room.startDateFormatted;
                                else if (item.condition === 'Arrival') isRelevant = room.status === 'Arrival' || room.status === 'Depart/Arrive';
                                return (room[key] > 0 && isRelevant);
                            }).map(item => {
                                let label = item.name;
                                if (item.hasValue && room[`${item.key}Value`] > 0) label += ` (¬£${room[`${item.key}Value`]} Total)`;
                                else if (item.hasValue && room[item.key] > 0) label += ` (Price N/A)`;
                                return `${item.emoji} ${label}`;
                            });
                            return `${room.room}: ${activeItems.join(', ')}`;
                        });
                        listContainer.appendChild(createScreenListSection('Extra List', listItems));
                    }
                }

                if (listContainer.hasChildNodes()) outputContainer.appendChild(listContainer);
            }

            function createScreenTableForRooms(rooms) {
                const tableWrapper = document.createElement('div'); tableWrapper.className = 'bg-white rounded-3xl shadow-lg border overflow-x-auto';
                const table = document.createElement('table'); table.className = 'w-full';
                let headerHtml = '<thead><tr class="divide-x"><th class="sticky left-0 z-20 p-4 bg-sky-100/70"></th>';
                rooms.forEach(room => { let screenColor = 'bg-blue-100'; if (room.status === 'Arrival') screenColor = 'bg-green-100'; if (room.status === 'Depart') screenColor = 'bg-red-100'; if (room.status === 'Depart/Arrive') screenColor = 'bg-purple-100'; headerHtml += `<th class="p-3 font-extrabold text-center ${screenColor}">${room.room}</th>`; });
                headerHtml += '</tr></thead>';

                const tbody = document.createElement('tbody'); tbody.className = 'divide-y';
                const rows = [];
                if (showUsedLastNightRowCheckbox.checked) rows.push('Used Last Night');
                if (showArrivingTodayRowCheckbox.checked) rows.push('Arriving Today');
                if (showGuestsRowCheckbox.checked) rows.push('Guests');
                if (showPetRowCheckbox.checked) rows.push('Pet');
                if (showTwinRowCheckbox.checked) rows.push('Twin');
                if (showDaybedRowCheckbox.checked) rows.push('Daybed');
                if (showTrundleRowCheckbox.checked) rows.push('Trundle');

                const isExtrasRowVisible = showExtrasRowCheckbox.checked;

                const hasExtraProducts = rooms.some(room =>
                    HK_EXTRA_PRODUCTS.some(item => {
                        const key = item.key;
                        let isRelevant = false;
                        if (item.condition === 'DepartureDay') isRelevant = room.reportDateFormatted === room.endDateFormatted;
                        else if (item.condition === 'ArrivalDay') isRelevant = room.reportDateFormatted === room.startDateFormatted;
                        else if (item.condition === 'Arrival') isRelevant = room.status === 'Arrival' || room.status === 'Depart/Arrive';
                        return (room[key] > 0 && isRelevant);
                    })
                );

                if (isExtrasRowVisible && hasExtraProducts) rows.push('Extra');

                rows.forEach(feature => {
                    let rowHtml = '';
                    if (feature === 'Extra') {
                        let rowContentHtml = `<tr class="group divide-x"><td class="sticky left-0 z-10 bg-white group-hover:bg-sky-50/70 p-3 pl-6 font-semibold text-gray-800">${feature}</td>`;
                        rooms.forEach(room => {
                            let extraItems = [];
                            HK_EXTRA_PRODUCTS.forEach(item => {
                                const key = item.key;
                                let isRelevant = false;
                                if (item.condition === 'DepartureDay') isRelevant = room.reportDateFormatted === room.endDateFormatted;
                                else if (item.condition === 'ArrivalDay') isRelevant = room.reportDateFormatted === room.startDateFormatted;
                                else if (item.condition === 'Arrival') isRelevant = room.status === 'Arrival' || room.status === 'Depart/Arrive';
                                if (room[item.key] > 0 && isRelevant) {
                                    extraItems.push(`<span>${item.emoji}</span>`);
                                }
                            });
                            const cellContent = extraItems.join(' ');
                            rowContentHtml += `<td class="p-3 text-center font-bold group-hover:bg-sky-50/70 compact-display">${cellContent}</td>`;
                        });
                        rowContentHtml += '</tr>';
                        rowHtml = rowContentHtml;
                    } else {
                        rowHtml = `<tr class="group divide-x"><td class="sticky left-0 z-10 bg-white group-hover:bg-sky-50/70 p-3 pl-6 font-semibold">${feature}</td>`;
                        rooms.forEach(room => {
                            let value = '';
                            const needsAlert = room.guests >= 3 && room.daybed === 0 && room.trundle === 0;
                            const alertClass = needsAlert ? 'bg-yellow-100/50' : '';
                            if (!((room.status === 'Stay' && !showStayingRoomInfoCheckbox.checked) || (room.status === 'Depart' && !showDepartingRoomInfoCheckbox.checked))) {
                                const isUsed = room.status === 'Stay' || room.status === 'Depart' || room.status === 'Depart/Arrive';
                                const isArriving = room.status === 'Arrival' || room.status === 'Depart' || room.status === 'Depart/Arrive';
                                let tickValue = isSparkleMode ? tickEmojis[currentTickIndex] : '‚úì';
                                let petValue = room.pet > 0 ? (isSparkleMode ? 'üê∂'.repeat(room.pet) : room.pet) : '';

                                switch (feature) {
                                    case 'Used Last Night': value = isUsed ? tickValue : ''; break;
                                    case 'Arriving Today': value = isArriving ? tickValue : ''; break;
                                    case 'Guests': value = room.guests > 0 ? room.guests : ''; break;
                                    case 'Pet': value = room.pet > 0 ? room.pet : ''; break;
                                    case 'Twin': value = room.twin > 0 ? (tickValue + (room.isTwinTurnaround ? '‚≠ê' : '')) : ''; break;
                                    case 'Daybed': value = (room.daybed > 0 ? tickValue : '') + (needsAlert ? ' ‚ö†Ô∏è' : ''); break;
                                    case 'Trundle': value = (room.trundle > 0 ? tickValue : '') + (needsAlert ? ' ‚ö†Ô∏è' : ''); break;
                                }
                            }
                            rowHtml += `<td class="p-3 text-center font-bold group-hover:bg-sky-50/70 ${alertClass}">${value}</td>`;
                        });
                        rowHtml += '</tr>';
                    }
                    tbody.innerHTML += rowHtml;
                });

                table.innerHTML = headerHtml; table.appendChild(tbody); tableWrapper.appendChild(table); return tableWrapper;
            }

            function createScreenListSection(title, content) {
                const container = document.createElement('div');
                container.className = 'mb-6 p-4 bg-sky-50 rounded-xl';
                if (Array.isArray(content)) {
                    const listContent = content.map(item => `<li class="ml-4">${item}</li>`).join('');
                    container.innerHTML = `<h3 class="text-lg font-bold text-sky-800 mb-2">${title}</h3><ul class="list-disc text-gray-700">${listContent}</ul>`;
                } else {
                    container.innerHTML = `<h3 class="text-lg font-bold text-sky-800 mb-2">${title}</h3><p class="text-gray-700 font-medium">${content}</p>`;
                }
                return container;
            }

            function generatePrintView(rooms) {
                printTableContainer.innerHTML = '';
                const needsAlertKey = rooms.some(room => room.guests >= 3 && room.daybed === 0 && room.trundle === 0);
                const hasTwinTurnaround = rooms.some(room => room.isTwinTurnaround);

                const renderedExtras = HK_EXTRA_PRODUCTS.filter(item => {
                    return rooms.some(room => {
                        const key = item.key;
                        let isRelevant = false;
                        if (item.condition === 'DepartureDay') isRelevant = room.reportDateFormatted === room.endDateFormatted;
                        else if (item.condition === 'ArrivalDay') isRelevant = room.reportDateFormatted === room.startDateFormatted;
                        else if (item.condition === 'Arrival') isRelevant = room.status === 'Arrival' || room.status === 'Depart/Arrive';
                        return (room[key] > 0 && isRelevant);
                    });
                });

                let extrasListHtml = '';
                if (showExtrasRowCheckbox.checked && renderedExtras.length > 0) {
                     extrasListHtml = renderedExtras.map(item => {
                         const name = item.name;
                         const valueText = item.hasValue ? '(Total Value)' : '';
                         return `<div style="display: flex; align-items: center; white-space: nowrap; margin-right: 1rem;"><span style="font-size: 1.25rem; margin-right: 0.3rem;">${item.emoji}</span><strong>${name}</strong> ${valueText}</div>`;
                     }).join('');
                }

                let keyHtml = `<div style="border: 1px solid #334155; margin-bottom: 0.5rem; background: #f1f5f9; padding: 0.5rem 1rem;">
                         <h4 style="font-size: 1.25rem; font-weight: bold; text-align: center; margin-bottom: 0.5rem;">Housekeeping Key</h4>
                         <div style="display: flex; flex-wrap: wrap; justify-content: flex-start; align-items: center; gap: 0.75rem 1rem;">
                            <div style="display: flex; flex-wrap: wrap; gap: 0.75rem 1rem; padding-right: 1rem; border-right: 1px solid #ccc;">
                                <div style="display: flex; align-items: center; white-space: nowrap;"><span style="display: inline-block; width: 1rem; height: 1rem; background-color: #d8c9e5; margin-right: 0.5rem; border: 1px solid black;"></span><strong>Depart/Arrive</strong></div>
                                <div style="display: flex; align-items: center; white-space: nowrap;"><span style="display: inline-block; width: 1rem; height: 1rem; background-color: #b3e6c9; margin-right: 0.5rem; border: 1px solid black;"></span><strong>Arrival</strong></div>
                                <div style="display: flex; align-items: center; white-space: nowrap;"><span style="display: inline-block; width: 1rem; height: 1rem; background-color: #e0a6b5; margin-right: 0.5rem; border: 1px solid black;"></span><strong>Depart</strong></div>
                                <div style="display: flex; align-items: center; white-space: nowrap;"><span style="display: inline-block; width: 1rem; height: 1rem; background-color: #c9d8e6; margin-right: 0.5rem; border: 1px solid black;"></span><strong>Stay</strong></div>
                            </div>
                            <div style="display: flex; flex-wrap: wrap; gap: 0.75rem 1rem; padding-right: 1rem; border-right: 1px solid #ccc;">
                                 ${hasTwinTurnaround ? `<div style="display: flex; align-items: center; white-space: nowrap;"><span style="margin-right: 0.5rem; font-size: 1.25rem;">‚≠ê</span><strong>Twin Turnaround</strong></div>` : ''}
                                 ${needsAlertKey ? `<div style="display: flex; align-items: center; white-space: nowrap;"><span style="margin-right: 0.5rem; font-size: 1.25rem;">‚ö†Ô∏è</span><strong>Capacity Alert</strong></div>` : ''}
                            </div>
                            <div style="display: flex; flex-wrap: wrap; justify-content: flex-start; gap: 0.75rem 1rem; padding-left: 0.5rem;">${extrasListHtml}</div>
                         </div>
                        </div>`; 

                printTableContainer.innerHTML += keyHtml;

                const floors = [{ title: 'Ground Floor', rooms: rooms.filter(r => parseInt(r.room) <= 6) }, { title: 'First Floor', rooms: rooms.filter(r => parseInt(r.room) >= 101 && parseInt(r.room) <= 130) }, { title: 'Second Floor', rooms: rooms.filter(r => parseInt(r.room) >= 201 && parseInt(r.room) <= 230) }];
                floors.forEach(floor => { if (floor.rooms.length > 0) { const floorContainer = document.createElement('div'); floorContainer.className = 'floor-section-print'; floorContainer.innerHTML = `<h2 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem;">${floor.title}</h2>`; floorContainer.appendChild(createClassicPrintTable(floor.rooms)); printTableContainer.appendChild(floorContainer); } });

                const listContainer = document.createElement('div'); listContainer.className = "floor-section-print";

                if (showStayingRoomsListCheckbox.checked) {
                    const staying = rooms.filter(r => r.status === 'Stay').map(r => r.room);
                    if (staying.length > 0) listContainer.appendChild(createPrintListSection('Staying Rooms List', staying.join(', ')));
                }

                if (showPetRoomsListCheckbox.checked) { const pets = rooms.filter(r => r.pet > 0).map(r => r.room); if (pets.length > 0) listContainer.appendChild(createPrintListSection('Pet Rooms List', pets.join(', '))); }
                if (showTwinRoomsListCheckbox.checked) { const twins = rooms.filter(r => r.twin > 0).map(r => r.room); if (twins.length > 0) listContainer.appendChild(createPrintListSection('Twin Rooms List', twins.join(', '))); }

                if (showExtrasRoomsListCheckbox.checked) {
                    const extraRooms = rooms.filter(room => {
                        return HK_EXTRA_PRODUCTS.some(item => {
                            const key = item.key;
                            let isRelevant = false;
                            if (item.condition === 'DepartureDay') isRelevant = room.reportDateFormatted === room.endDateFormatted;
                            else if (item.condition === 'ArrivalDay') isRelevant = room.reportDateFormatted === room.startDateFormatted;
                            else if (item.condition === 'Arrival') isRelevant = room.status === 'Arrival' || room.status === 'Depart/Arrive';
                            return (room[key] > 0 && isRelevant);
                        });
                    });

                    if (extraRooms.length > 0) {
                        const listItems = extraRooms.map(room => {
                            const activeItems = HK_EXTRA_PRODUCTS.filter(item => {
                                const key = item.key;
                                let isRelevant = false;
                                if (item.condition === 'DepartureDay') isRelevant = room.reportDateFormatted === room.endDateFormatted;
                                else if (item.condition === 'ArrivalDay') isRelevant = room.reportDateFormatted === room.startDateFormatted;
                                else if (item.condition === 'Arrival') isRelevant = room.status === 'Arrival' || room.status === 'Depart/Arrive';
                                return (room[key] > 0 && isRelevant);
                            }).map(item => {
                                let label = item.name;
                                if (item.hasValue && room[`${item.key}Value`] > 0) label += ` (¬£${room[`${item.key}Value`]} Total)`;
                                else if (item.hasValue && room[item.key] > 0) label += ` (Price N/A)`;
                                return `${item.emoji} ${label}`;
                            });
                            return `${room.room}: ${activeItems.join(', ')}`;
                        });
                        listContainer.appendChild(createPrintListSection('Extra List', listItems));
                    }
                }

                if (listContainer.hasChildNodes()) printTableContainer.appendChild(listContainer);
            }

            function createClassicPrintTable(rooms) {
                const table = document.createElement('table'); table.className = 'print-table-classic';
                let headerHtml = '<thead><tr><th></th>';
                rooms.forEach(room => { let printBgColor = '#f1f5f9'; if (room.status === 'Arrival') printBgColor = '#b3e6c9'; if (room.status === 'Depart') printBgColor = '#e0a6b5'; if (room.status === 'Depart/Arrive') printBgColor = '#d8c9e5'; if (room.status === 'Stay') printBgColor = '#c9d8e6'; headerHtml += `<th style="background-color: ${printBgColor};">${room.room}</th>`; });
                headerHtml += '</tr></thead>';

                const tbody = document.createElement('tbody');
                const rows = [];
                if (showUsedLastNightRowCheckbox.checked) rows.push('Used Last Night');
                if (showArrivingTodayRowCheckbox.checked) rows.push('Arriving Today');
                if (showGuestsRowCheckbox.checked) rows.push('Guests');
                if (showPetRowCheckbox.checked) rows.push('Pet');
                if (showTwinRowCheckbox.checked) rows.push('Twin');
                if (showDaybedRowCheckbox.checked) rows.push('Daybed');
                if (showTrundleRowCheckbox.checked) rows.push('Trundle');

                const isExtrasRowVisible = showExtrasRowCheckbox.checked;

                const hasExtraProducts = rooms.some(room =>
                    HK_EXTRA_PRODUCTS.some(item => {
                        const key = item.key;
                        let isRelevant = false;
                        if (item.condition === 'DepartureDay') isRelevant = room.reportDateFormatted === room.endDateFormatted;
                        else if (item.condition === 'ArrivalDay') isRelevant = room.reportDateFormatted === room.startDateFormatted;
                        else if (item.condition === 'Arrival') isRelevant = room.status === 'Arrival' || room.status === 'Depart/Arrive';
                        return (room[key] > 0 && isRelevant);
                    })
                );

                if (isExtrasRowVisible && hasExtraProducts) rows.push('Extra');

                rows.forEach(feature => {
                    let rowHtml = '';
                    if (feature === 'Extra') {
                        let rowContentHtml = `<tr><td style="font-align: left; padding: 0.5rem; background-color: #f1f5f9; border: 1px solid #334155; font-weight: bold; text-align: left;">Extra</td>`;
                        rooms.forEach(room => {
                            let extraItems = [];
                            HK_EXTRA_PRODUCTS.forEach(item => {
                                const key = item.key;
                                let isRelevant = false;
                                if (item.condition === 'DepartureDay') isRelevant = room.reportDateFormatted === room.endDateFormatted;
                                else if (item.condition === 'ArrivalDay') isRelevant = room.reportDateFormatted === room.startDateFormatted;
                                else if (item.condition === 'Arrival') isRelevant = room.status === 'Arrival' || room.status === 'Depart/Arrive';
                                if (room[item.key] > 0 && isRelevant) {
                                    extraItems.push(`<span>${item.emoji}</span>`);
                                }
                            });
                            const cellContent = extraItems.join(' ');
                            rowContentHtml += `<td style="text-align: center; border: 1px solid #334155; padding: 0.5rem; background-color: #ffffff;">${cellContent}</td>`;
                        });
                        rowContentHtml += '</tr>';
                        rowHtml = rowContentHtml;
                    } else {
                        rowHtml = `<tr><td style="text-align: left; font-weight: bold; padding: 0.5rem; background-color: #f1f5f9;">${feature}</td>`;
                        rooms.forEach(room => {
                            let value = '';
                            const needsAlert = room.guests >= 3 && room.daybed === 0 && room.trundle === 0;
                            const printAlertStyle = needsAlert ? 'style="background-color: #fffbe6;"' : '';
                            if (!((room.status === 'Stay' && !showStayingRoomInfoCheckbox.checked) || (room.status === 'Depart' && !showDepartingRoomInfoCheckbox.checked))) {
                                const isUsed = room.status === 'Stay' || room.status === 'Depart' || room.status === 'Depart/Arrive';
                                const isArriving = room.status === 'Arrival' || room.status === 'Depart' || room.status === 'Depart/Arrive';
                                const tickValue = '‚úì';
                                switch (feature) {
                                    case 'Used Last Night': value = isUsed ? tickValue : ''; break;
                                    case 'Arriving Today': value = isArriving ? tickValue : ''; break;
                                    case 'Guests': value = room.guests > 0 ? room.guests : ''; break;
                                    case 'Pet': value = room.pet > 0 ? room.pet : ''; break;
                                    case 'Twin': value = room.twin > 0 ? (tickValue + (room.isTwinTurnaround ? '‚≠ê' : '')) : ''; break;
                                    case 'Daybed': value = (room.daybed > 0 ? tickValue : '') + (needsAlert ? ' ‚ö†Ô∏è' : ''); break;
                                    case 'Trundle': value = (room.trundle > 0 ? tickValue : '') + (needsAlert ? ' ‚ö†Ô∏è' : ''); break;
                                }
                            }
                            rowHtml += `<td style="text-align: center; border: 1px solid #334155; padding: 0.5rem;" ${printAlertStyle}>${value}</td>`;
                        });
                        rowHtml += '</tr>';
                    }
                    tbody.innerHTML += rowHtml;
                });
                table.innerHTML = headerHtml; table.appendChild(tbody); return table;
            }

            function createPrintListSection(title, content) {
                const container = document.createElement('div');
                container.style.marginBottom = '1rem';
                if (Array.isArray(content)) {
                    const listContent = content.map(item => `<li>${item}</li>`).join('');
                    container.innerHTML = `<h3 style="font-size: 1.25rem; font-weight: bold; margin-bottom: 0.5rem; color: #075985;">${title}</h3><ul style="list-style: none; font-size: 1.1rem; padding-left: 0;">${listContent}</ul>`;
                } else {
                     container.innerHTML = `<h3 style="font-size: 1.25rem; font-weight: bold; margin-bottom: 0.5rem; color: #075985;">${title}</h3><p style="font-size: 1.1rem;">${content}</p>`;
                }
                return container;
            }

            function updateStatus(message, type) { statusDiv.textContent = message; statusDiv.className = 'text-center mt-4 font-semibold '; switch (type) { case 'error': statusDiv.classList.add('text-red-600'); break; case 'success': statusDiv.classList.add('text-green-600'); break; default: statusDiv.classList.add('text-gray-600'); break; } }
            updateSparkleMode(isSparkleMode);
        }

        // --- FRONT HALL SCRIPT (NEW) ---
        let fh_parsedData = [];
        let fh_currentView = 'arrivals';

        function fh_init() {
             // Any initialization logic for Front Hall can go here
        }

        function fh_processData() {
            const rawText = document.getElementById('fh-data-input').value;
            const dateInput = document.getElementById('fh-date-picker');
            
            if (!dateInput.value) {
                const dateMatch = rawText.match(/(\d{2})\/([A-Za-z]{3})\/(\d{4})/);
                if (dateMatch) {
                     const months = {Jan:'01', Feb:'02', Mar:'03', Apr:'04', May:'05', Jun:'06', Jul:'07', Aug:'08', Sep:'09', Oct:'10', Nov:'11', Dec:'12'};
                     dateInput.value = `${dateMatch[3]}-${months[dateMatch[2]]}-${dateMatch[1]}`;
                }
            }

            const lines = rawText.split('\n');
            let currentSection = '';
            let rooms = [];
            let currentRoomObj = null;

            const bookingLineRegex = /(\d{2}\/[A-Za-z]{3}\/\d{4})\s+(\d{2}\/[A-Za-z]{3}\/\d{4}).*?(BK\S+)\s+.*?\s+(\d{3})\s/;
            const noteHeadersRegex = /^(Public Notes|Private Notes|Distribution Notes|Food & Beverage Notes|Housekeeping Notes|Confirmation Notes|Assistance Required|Car Reg|Imported PMS Ref|Extras)(:| \:)/i;

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;

                if (line.includes('Bedroom Arrivals')) { currentSection = 'Arrivals'; continue; }
                if (line.includes('Bedroom Departures')) { currentSection = 'Departures'; continue; }
                if (line.includes('Bedroom Residents')) { currentSection = 'Stay'; continue; } 
                
                let source = 'Internal';
                if (line.toLowerCase().includes('booking.com')) source = 'Booking.com';
                else if (line.toLowerCase().includes('expedia')) source = 'Expedia';
                else if (line.toLowerCase().includes('guestline')) source = 'Guestline';
                else if (line.toLowerCase().includes('transfer')) source = 'Transfer';
                
                const match = line.match(bookingLineRegex);
                if (match) {
                     const roomId = match[4];
                     const dateIndex = line.indexOf(match[1]);
                     let rawName = line.substring(0, dateIndex).trim();
                     let guests = 2;
                     const paxMatch = line.match(new RegExp(`${roomId}\\s+\\S+\\s+(\\d+)`));
                     if(paxMatch) guests = parseInt(paxMatch[1], 10);

                     currentRoomObj = {
                         room: roomId,
                         name: rawName,
                         guests: guests,
                         section: currentSection,
                         source: source,
                         bookRef: match[3],
                         hasVCC: false, 
                         notes: [] 
                     };
                     rooms.push(currentRoomObj);
                } else if (currentRoomObj) {
                    if (line.toLowerCase().includes('virtual credit card') || line.includes('VCC')) {
                        currentRoomObj.hasVCC = true;
                    }
                    if (currentRoomObj.source === 'Internal') {
                         if (line.toLowerCase().includes('booking.com')) currentRoomObj.source = 'Booking.com';
                         else if (line.toLowerCase().includes('expedia')) currentRoomObj.source = 'Expedia';
                    }
                    if (noteHeadersRegex.test(line)) {
                        let cleanLine = line.replace(/Distribution Notes:\s*smoking preference: Non-Smoking/i, '').trim();
                        if(cleanLine) currentRoomObj.notes.push(cleanLine);
                    }
                    else if (line.includes('Prepayment:') || line.includes('VCC details:')) {
                         currentRoomObj.notes.push(line);
                    }
                    else if (line.includes('BED PREFERENCE:')) {
                         currentRoomObj.notes.push(line);
                    }
                }
            }
            
            fh_parsedData = rooms;
            fh_renderList();
        }

        function fh_renderList() {
            const container = document.getElementById('fh-list-content');
            const placeholder = document.getElementById('fh-placeholder');
            
            if (!fh_parsedData || fh_parsedData.length === 0) {
                container.classList.add('hidden');
                placeholder.classList.remove('hidden');
                return;
            }

            container.classList.remove('hidden');
            placeholder.classList.add('hidden');

            const viewData = fh_parsedData.filter(r => r.section.toLowerCase().includes(fh_currentView === 'arrivals' ? 'arrival' : 'departure'));
            viewData.sort((a, b) => parseInt(a.room) - parseInt(b.room));

            let html = `<h3 class="text-xl font-bold text-gray-800 mb-4 capitalize">${fh_currentView} (${viewData.length})</h3>`;
            
            if (viewData.length === 0) {
                html += `<p class="text-gray-500 italic">No ${fh_currentView} found.</p>`;
            } else {
                html += `<div class="space-y-2">`;
                viewData.forEach(room => {
                    const sourceColor = fh_getColorForSource(room.source);
                    html += `
                    <div class="flex flex-col sm:flex-row sm:items-start justify-between p-3 border-b border-gray-100 hover:bg-gray-50 transition">
                        <div class="flex items-center gap-3 w-full sm:w-1/4">
                            <span class="text-lg font-bold text-gray-800 w-10">${room.room}</span>
                            <div class="flex flex-col">
                                <span class="font-medium text-gray-900">${room.name}</span>
                                <span class="text-xs text-gray-500">Pax: ${room.guests}</span>
                            </div>
                        </div>
                        <div class="mt-2 sm:mt-0 w-full sm:w-1/4">
                             <span class="source-badge ${sourceColor}">${room.source}</span>
                        </div>
                        <div class="mt-2 sm:mt-0 w-full sm:w-1/2 text-sm text-gray-600">
                            ${room.hasVCC ? '<div class="vcc-alert">VCC Alert</div>' : ''}
                            ${room.notes.map(n => `<div class="note-line">${n.replace(/^([^:]+):/, '<span class="note-label">$1</span>')}</div>`).join('')}
                        </div>
                    </div>`;
                });
                html += `</div>`;
            }
            container.innerHTML = html;
        }

        function fh_switchView(view) {
            fh_currentView = view;
            const btnArr = document.getElementById('btn-view-arr');
            const btnDep = document.getElementById('btn-view-dep');
            if (view === 'arrivals') {
                btnArr.classList.remove('bg-white', 'text-gray-600', 'border', 'border-gray-200');
                btnArr.classList.add('bg-orange-500', 'text-white');
                btnDep.classList.remove('bg-orange-500', 'text-white');
                btnDep.classList.add('bg-white', 'text-gray-600', 'border', 'border-gray-200');
            } else {
                btnDep.classList.remove('bg-white', 'text-gray-600', 'border', 'border-gray-200');
                btnDep.classList.add('bg-orange-500', 'text-white');
                btnArr.classList.remove('bg-orange-500', 'text-white');
                btnArr.classList.add('bg-white', 'text-gray-600', 'border', 'border-gray-200');
            }
            fh_renderList();
        }
        
        function fh_getColorForSource(source) {
            const s = source.toLowerCase();
            if (s.includes('booking')) return 'source-booking';
            if (s.includes('expedia')) return 'source-expedia';
            if (s.includes('direct') || s.includes('internal')) return 'source-direct';
            if (s.includes('transfer')) return 'source-transfer';
            if (s.includes('guestline')) return 'source-guestline';
            return 'source-other';
        }

        function fh_clearData() {
             document.getElementById('fh-data-input').value = '';
             fh_parsedData = [];
             fh_renderList();
        }

        function fh_printCurrentView() {
            if (!fh_parsedData || fh_parsedData.length === 0) { alert("No data to print"); return; }
            const viewName = fh_currentView === 'arrivals' ? 'Arrival' : 'Departure';
            const filterKey = fh_currentView === 'arrivals' ? 'arrival' : 'departure';
            const dataToPrint = fh_parsedData.filter(r => r.section.toLowerCase().includes(filterKey));
            dataToPrint.sort((a, b) => parseInt(a.room) - parseInt(b.room));
            
            const dateVal = document.getElementById('fh-date-picker').value;
            const dateObj = dateVal ? new Date(dateVal) : new Date();
            const dateStr = dateObj.toLocaleDateString('en-GB', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });

            const ground = dataToPrint.filter(r => parseInt(r.room) < 100);
            const first = dataToPrint.filter(r => parseInt(r.room) >= 100 && parseInt(r.room) < 200);
            const second = dataToPrint.filter(r => parseInt(r.room) >= 200);

            const createPrintSection = (title, rooms) => {
                if (rooms.length === 0) return '';
                let rows = rooms.map(r => `
                    <tr>
                        <td style="font-weight:bold; text-align:center; width:10%;">${r.room}</td>
                        <td style="width:25%;">
                            <div style="font-weight:bold;">${r.name}</div>
                            <div style="font-size:0.85em; color:#555;">(${r.guests} Guests)</div>
                        </td>
                        <td style="text-align:center; width:15%;">
                             <span class="source-badge ${fh_getColorForSource(r.source)}">${r.source}</span>
                        </td>
                        <td style="width:50%; font-size:0.9em;">
                            ${r.hasVCC ? '<div style="color:#be123c; font-weight:bold; margin-bottom:4px;">!! VCC ALERT !!</div>' : ''}
                            ${r.notes.map(n => `<div>${n}</div>`).join('')}
                        </td>
                    </tr>
                `).join('');
                return `<div style="margin-bottom: 20px;"><h3 style="border-bottom: 2px solid #eee; padding-bottom: 5px; margin-bottom: 10px;">${title}</h3><table class="print-section-table"><thead><tr><th>Room</th><th>Guest</th><th>Source</th><th>Notes</th></tr></thead><tbody>${rows}</tbody></table></div>`;
            };

            const printWindow = window.open('', '_blank');
            printWindow.document.write(`<html><head><title>Front Hall - ${viewName}</title><style>body { font-family: sans-serif; font-size: 10pt; padding: 20px; } h1 { text-align: center; margin-bottom: 5px; } .meta { text-align: center; margin-bottom: 20px; font-size: 1.1em; color: #555; } .print-section-table { width: 100%; border-collapse: collapse; } .print-section-table th, .print-section-table td { border: 1px solid #ccc; padding: 6px; text-align: left; vertical-align: top; } .print-section-table th { background-color: #f3f4f6; } .source-badge { font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; font-weight: bold; text-transform: uppercase; color: white; display: inline-block; -webkit-print-color-adjust: exact; print-color-adjust: exact; } .source-booking { background-color: #003580; } .source-expedia { background-color: #FFC20E; color: black; } .source-direct { background-color: #059669; } .source-other { background-color: #6b7280; } .source-transfer { background-color: #f97316; } .source-guestline { background-color: #64748b; } .source-internal { background-color: #4ade80; color: black; }</style></head><body><h1>Front Hall - ${viewName} List</h1><div class="meta">${dateStr} &bull; Total: ${dataToPrint.length}</div>${createPrintSection('Ground Floor', ground)}${createPrintSection('First Floor', first)}${createPrintSection('Second Floor', second)}<script>setTimeout(() => { window.print(); window.close(); }, 500);<\/script></body></html>`);
            printWindow.document.close();
        }
    </script>
</body>
</html>
